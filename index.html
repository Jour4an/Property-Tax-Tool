<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brooks Property Tax Breakdown</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Importing Inter, Courier Prime, and Montserrat (Extra Bold 800, Black 900) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Courier+Prime:wght@400;700&family=Montserrat:wght@800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-brooks-primary: #0071bf; /* Blue */
            --color-brooks-secondary: #ff9936; /* Orange */
        }
        .text-brooks-primary { color: var(--color-brooks-primary); }
        .bg-brooks-primary { background-color: var(--color-brooks-primary); }
        .text-brooks-secondary { color: var(--color-brooks-secondary); }
        .border-brooks-secondary { border-color: var(--color-brooks-secondary); }

        /* The 'Receipt' style with Gradient */
        .receipt-container {
            background: linear-gradient(to bottom, #ffffff 0%, #f0f0f0 100%); /* Grey and white gradient */
            font-family: 'Courier Prime', monospace;
            border-radius: 4px;
            overflow: hidden;
        }

        /* Input field style */
        #assessmentInput {
            -webkit-appearance: none;
            -moz-appearance: textfield;
            font-family: 'Inter', sans-serif; /* Use Inter for input clarity */
            letter-spacing: 0.05em; /* Spacing for better number legibility */
        }

        /* Custom scrollbar for department breakdown on mobile */
        .scroll-list::-webkit-scrollbar { display: none; }
        .scroll-list { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-gray-100 p-4 sm:p-8 font-sans">

    <!-- Main Receipt Container -->
    <div class="receipt-container max-w-xl mx-auto mt-6 mb-12 p-6 md:p-8 border border-gray-300">

        <!-- Receipt Title -->
        <div class="text-center pb-4 border-b border-dashed border-gray-400 mb-6">
            <h2 class="text-2xl font-black uppercase tracking-widest text-brooks-primary mb-1" style="font-family: 'Montserrat', sans-serif;">
                City of Brooks
            </h2>
            <h3 class="text-xl font-extrabold uppercase tracking-widest text-brooks-secondary" style="font-family: 'Montserrat', sans-serif;">
                Property Tax Receipt
            </h3>
        </div>

        <!-- Input Section -->
        <div class="text-center mb-6">
            <label for="assessmentInput" class="text-sm font-medium block mb-2 text-gray-700 font-inter">
                Enter Property Assessment Value (CAD)
            </label>
            <div class="flex justify-center items-center">
                <span class="text-3xl mr-1 text-brooks-primary font-courier-prime">$</span>
                <input
                    type="text"
                    id="assessmentInput"
                    value="350,000"
                    min="1"
                    class="text-3xl font-bold p-2 w-48 text-center border-2 border-gray-300 rounded-lg focus:outline-none focus:border-brooks-secondary transition duration-150 font-inter"
                    oninput="formatAssessmentInput(this); calculateTaxes();"
                >
            </div>
        </div>

        <!-- Calculated Totals -->
        <div class="mb-6 border-t border-dashed border-gray-400 pt-4">
            <h3 class="text-base font-bold mb-2 text-gray-800 uppercase tracking-wider font-inter">
                Estimated 2025 Total Tax Bill
            </h3>
            <div class="flex justify-between items-center text-3xl font-bold mb-4 text-brooks-primary border-b border-dashed border-gray-400 pb-2">
                <span class="font-courier-prime uppercase">TOTAL AMOUNT:</span>
                <span id="totalTaxDisplay" class="font-courier-prime text-3xl"></span>
            </div>
        </div>

        <!-- Primary Tax Breakdown (3-Way Split) -->
        <div class="mb-6 p-4 bg-white rounded-md border-brooks-secondary border-l-4">
            <h3 class="text-base font-semibold mb-3 font-inter text-gray-800">1. Primary Allocation</h3>
            <div id="primaryBreakdown" class="text-sm">
                <!-- Data will be inserted here by JavaScript -->
            </div>
        </div>

        <!-- Departmental Breakdown (Toggle) -->
        <div class="mt-8 border-t border-dashed border-gray-400 pt-6">
            <h3 class="text-base font-bold mb-4 text-gray-800 uppercase tracking-wider font-inter">2. Municipal Services Breakdown (77%)</h3>

            <button onclick="toggleDepartmentBreakdown()" id="toggleButton"
                class="w-full bg-brooks-secondary text-brooks-primary font-bold py-3 px-4 rounded-lg shadow-md hover:bg-opacity-90 transition duration-150 flex items-center justify-center font-inter text-sm"
                >
                <span class="mr-2">Show Detailed Municipal Spending</span>
                <svg id="toggleIcon" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 transition-transform duration-300" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
            </button>

            <div id="departmentBreakdownContainer" class="hidden mt-4 scroll-list overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-300">
                    <thead class="bg-gray-200">
                        <tr>
                            <th class="py-2 px-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider sticky left-0 bg-gray-200 font-inter">Department</th>
                            <th class="py-2 px-3 text-right text-xs font-bold text-gray-600 uppercase tracking-wider whitespace-nowrap font-inter">Your Bill Share</th>
                        </tr>
                    </thead>
                    <tbody id="departmentBreakdownTable" class="bg-white divide-y divide-gray-200 text-xs">
                        <!-- Data will be inserted here by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <script>
        // Constants for the City of Brooks Tax Calculation
        // Mill Rate provided by user: 10.961423 (per $1000 of assessed value)
        // Converted to per-dollar rate for calculation: 10.961423 / 1000
        const MILL_RATE = 0.010961423; 

        // Primary Tax Breakdown (of Total Tax Bill)
        const PRIMARY_BREAKDOWN = [
            { name: "Municipal Portion", percentage: 0.77, color: 'var(--color-brooks-primary)' },
            { name: "Alberta Education Portion", percentage: 0.22, color: '#4CAF50' },
            { name: "Newell Foundation", percentage: 0.01, color: '#f44336' }
        ];

        // Original Departmental Breakdown (of the MUNICIPAL PORTION ONLY - 77% of total tax)
        const DEPARTMENT_BREAKDOWN = [
            { name: "Policing", cents: 21.0 },
            { name: "Recreation", cents: 17.2 },
            { name: "Transportation", cents: 16.7 },
            { name: "Administration", cents: 11.0 },
            { name: "Parks", cents: 6.5 },
            { name: "Culture and Facilities", cents: 5.3 },
            { name: "Fiscal and Taxation", cents: 5.1 },
            { name: "Fire", cents: 4.11 },
            { name: "Community Support Services", cents: 3.3 },
            { name: "Municipal Enforcement", cents: 2.1 },
            { name: "Planning and Development", cents: 2.0 },
            { name: "Council", cents: 1.8 },
            { name: "Economic Development", cents: 1.1 },
            { name: "Access Transit", cents: 1.0 },
            { name: "Land", cents: 0.5 },
            { name: "Cemetery", cents: 0.5 },
            { name: "Engineering", cents: 0.4 },
            { name: "Airport", cents: 0.4 },
        ];


        /**
         * Formats a number as currency (CAD).
         * @param {number} amount
         * @returns {string} Formatted currency string.
         */
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-CA', {
                style: 'currency',
                currency: 'CAD',
                minimumFractionDigits: 2,
            }).format(amount);
        }

        /**
         * Formats the input value with commas and keeps the cursor position.
         * @param {HTMLInputElement} input
         */
        function formatAssessmentInput(input) {
            const cursorPosition = input.selectionStart;
            const oldValue = input.value;
            let value = input.value.replace(/[^0-9]/g, ''); // Remove all non-numeric characters

            if (value === '') {
                input.value = '';
                return;
            }

            // Convert back to number to format, then back to string with commas
            const number = parseInt(value, 10);
            const formattedValue = new Intl.NumberFormat('en-CA').format(number);

            input.value = formattedValue;

            // Maintain cursor position (complex logic simplified for robust environment)
            const newLength = formattedValue.length;
            const oldLength = oldValue.length;
            const difference = newLength - oldLength;

            // Try to set the cursor position back near where it was
            if (cursorPosition !== null) {
                input.setSelectionRange(cursorPosition + difference, cursorPosition + difference);
            }
        }

        /**
         * Calculates the total tax and updates all breakdown sections.
         */
        function calculateTaxes() {
            const inputElement = document.getElementById('assessmentInput');
            // Crucially, remove commas before calculation
            const assessmentValue = parseFloat(inputElement.value.replace(/[^0-9.]/g, ''));

            if (isNaN(assessmentValue) || assessmentValue <= 0) {
                // Reset display if input is invalid
                document.getElementById('totalTaxDisplay').textContent = formatCurrency(0);
                document.getElementById('primaryBreakdown').innerHTML = '<p class="text-red-500">Please enter a valid assessment value.</p>';
                document.getElementById('departmentBreakdownTable').innerHTML = '';
                return;
            }

            // 1. Calculate Total Tax
            const totalTax = assessmentValue * MILL_RATE;
            document.getElementById('totalTaxDisplay').textContent = formatCurrency(totalTax);

            // 2. Primary Breakdown (77%, 22%, 1%)
            updatePrimaryBreakdown(totalTax);

            // 3. Departmental Breakdown (based on 77% municipal share)
            const municipalPortion = totalTax * PRIMARY_BREAKDOWN[0].percentage;
            updateDepartmentBreakdown(municipalPortion);
        }

        /**
         * Updates the 3-way tax breakdown.
         * @param {number} totalTax - The calculated total property tax.
         */
        function updatePrimaryBreakdown(totalTax) {
            const breakdownHtml = PRIMARY_BREAKDOWN.map(item => {
                const shareAmount = totalTax * item.percentage;
                const percentageFormatted = (item.percentage * 100).toFixed(0);

                return `
                    <div class="flex justify-between items-center py-1 border-b border-dashed border-gray-300 last:border-b-0">
                        <span class="text-gray-700 font-courier-prime">${item.name} (${percentageFormatted}%):</span>
                        <span class="text-sm font-bold font-courier-prime" style="color:${item.color};">${formatCurrency(shareAmount)}</span>
                    </div>
                `;
            }).join('');

            document.getElementById('primaryBreakdown').innerHTML = breakdownHtml;
        }

        /**
         * Updates the detailed municipal spending breakdown.
         * @param {number} municipalPortion - The dollar amount going to the Municipal Portion (77% of total).
         */
        function updateDepartmentBreakdown(municipalPortion) {
            const tableBody = document.getElementById('departmentBreakdownTable');
            
            const tableRows = DEPARTMENT_BREAKDOWN.map(item => {
                // Calculate the true dollar share based on the cents/municipal dollar
                const percentageOfMunicipal = item.cents / 100;
                const shareAmount = municipalPortion * percentageOfMunicipal;

                return `
                    <tr>
                        <td class="py-1 px-3 whitespace-nowrap sticky left-0 bg-white font-courier-prime">
                            <span class="ml-1 font-medium">${item.name}</span>
                        </td>
                        <td class="py-1 px-3 text-right font-bold text-gray-800 font-courier-prime">${formatCurrency(shareAmount)}</td>
                    </tr>
                `;
            }).join('');

            tableBody.innerHTML = tableRows;
        }

        /**
         * Toggles the visibility of the departmental breakdown section.
         */
        function toggleDepartmentBreakdown() {
            const container = document.getElementById('departmentBreakdownContainer');
            const button = document.getElementById('toggleButton');
            const isHidden = container.classList.contains('hidden');

            if (isHidden) {
                container.classList.remove('hidden');
                button.innerHTML = '<span class="mr-2">Hide Detailed Municipal Spending</span> <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 transition-transform duration-300" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M14.707 12.707a1 1 0 01-1.414 0L10 9.414l-3.293 3.293a1 1 0 01-1.414-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 010 1.414z" clip-rule="evenodd" /></svg>';
            } else {
                container.classList.add('hidden');
                button.innerHTML = '<span class="mr-2">Show Detailed Municipal Spending</span> <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 transition-transform duration-300" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>';
            }
        }

        // Initialize the calculator on load
        window.onload = () => {
            const inputElement = document.getElementById('assessmentInput');
            formatAssessmentInput(inputElement);
            calculateTaxes();
        };

        // Note: Keyup/change listeners are no longer needed as the oninput attribute is used directly
    </script>

</body>
</html>